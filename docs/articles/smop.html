<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>smop: Simple but fast MOP analysis • smop</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="smop: Simple but fast MOP analysis">
<meta property="og:description" content="smop">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">smop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/smop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>smop: Simple but fast MOP analysis</h1>
            
      
      
      <div class="hidden name"><code>smop.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">smop</span><span class="op">)</span></span></code></pre></div>
<p>The <code>smop</code> package is a small R package (it has two main
functions) designed to perform the Mobility-Oriented Parity analysis
(MOP) both in fast fashion and taking care of memory usage. To do this
it uses optimized <code>C++</code> code via the <a href="https://cran.r-project.org/package=Rcpp" class="external-link"><code>Rcpp</code></a> and
<a href="https://cran.r-project.org/package=RcppArmadillo" class="external-link"><code>RcppArmadillo</code></a>
packages.</p>
<p>The MOP test was proposed in <a href="https://doi.org/10.1016/j.ecolmodel.2013.04.011" class="external-link">Owens et
al. 2013</a> to estimate regions where extrapolation occurs (Figure
1).</p>
<div class="float">
<img src="../reference/figures/Extrapolation_01.jpg" alt="Fig. 1. Extrapolation areas. Taken from Owens et al. 2013"><div class="figcaption">Fig. 1. Extrapolation areas. Taken from <a href="https://doi.org/10.1016/j.ecolmodel.2013.04.011" class="external-link">Owens et
al. 2013</a>
</div>
</div>
<div class="section level2">
<h2 id="example-of-use">Example of use<a class="anchor" aria-label="anchor" href="#example-of-use"></a>
</h2>
<p>First we estimate zones where strict extrapolation occurs. To show
this, we read environmental data from the calibration and the transfer
zones.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/M_layers"</span>, package <span class="op">=</span> <span class="st">"smop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">g_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/G_layers"</span>, package <span class="op">=</span> <span class="st">"smop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">M_calibra</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">m_path</span><span class="op">)</span></span>
<span><span class="va">G_transfer</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">g_path</span><span class="op">)</span></span></code></pre></div>
<p>Calibration area</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">M_calibra</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="smop_files/figure-html/unnamed-chunk-3-1.png" alt="Fig. 2. Calibration area in Centra America." width="700"><p class="caption">
Fig. 2. Calibration area in Centra America.
</p>
</div>
<p>Model transfer area</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">G_transfer</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="smop_files/figure-html/unnamed-chunk-4-1.png" alt="Fig. 3. Transfer area in South America" width="700"><p class="caption">
Fig. 3. Transfer area in South America
</p>
</div>
<p>Zones where strict extrapolation occurs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extr_zones</span> <span class="op">&lt;-</span> <span class="fu">smop</span><span class="fu">::</span><span class="fu"><a href="../reference/extrapolation_zones.html">extrapolation_zones</a></span><span class="op">(</span>M_calibra <span class="op">=</span> <span class="va">M_calibra</span>,</span>
<span>                                        G_transfer <span class="op">=</span> <span class="va">G_transfer</span>,</span>
<span>                                        as_vec <span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">extr_zones</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="smop_files/figure-html/unnamed-chunk-5-1.png" alt="Zones of strict extrapolation. The green zones represent areas where strcit extrapolation occurs" width="700"><p class="caption">
Zones of strict extrapolation. The green zones represent areas where
strcit extrapolation occurs
</p>
</div>
<div class="section level4">
<h4 id="the-mop-analysis">The MOP analysis<a class="anchor" aria-label="anchor" href="#the-mop-analysis"></a>
</h4>
<p>Now we perform the mop analysis</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example 1 compute mop distance in serial</span></span>
<span><span class="va">mop_test</span> <span class="op">&lt;-</span> <span class="fu">smop</span><span class="fu">::</span><span class="fu"><a href="../reference/mop.html">mop</a></span><span class="op">(</span>M_calibra <span class="op">=</span> <span class="va">M_calibra</span>, G_transfer <span class="op">=</span>  <span class="va">G_transfer</span>,</span>
<span>                      percent <span class="op">=</span> <span class="fl">10</span>,comp_each <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      normalized <span class="op">=</span> <span class="cn">TRUE</span>, standardize_vars<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_test</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="smop_files/figure-html/unnamed-chunk-6-1.png" alt="MOP analysis. In this map zero values (in gray) represent zones of strict extrapolation and values above it are zones with analogus climates." width="700"><p class="caption">
MOP analysis. In this map zero values (in gray) represent zones of
strict extrapolation and values above it are zones with analogus
climates.
</p>
</div>
<div class="section level5">
<h5 id="parallel-mop">Parallel MOP<a class="anchor" aria-label="anchor" href="#parallel-mop"></a>
</h5>
<p>The MOP analysis can be performed in parallel by evoking functions
from the <a href="https://furrr.futureverse.org/articles/progress.html" class="external-link"><code>furrr</code></a>
R package. Here, we use the <em>comp_each</em> parameter to specify the
number of pixels to be processed in each CPU core. The number of pixels
to be processed in each CPU core depends on the user’s RAM memory; if
the user has a computer with few RAM, it is recommended to process by
500 pixels, otherwise, it can be as high as 10,000 pixels. An
improvement from other versions of the <em>mop</em> function such as the
<a href="https://github.com/luismurao/ntbox/tree/master" class="external-link"><code>ntbox</code></a>
and the <a href="https://github.com/marlonecobos/kuenm" class="external-link"><code>kuenm</code></a>, is
that the performance of the function is less affected by the
parametrization of the <em>comp_each</em> parameter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example 2: Run the mop function in parallel</span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"future::multisession"</span>,workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mop_test_parallel</span> <span class="op">&lt;-</span> <span class="fu">smop</span><span class="fu">::</span><span class="fu"><a href="../reference/mop.html">mop</a></span><span class="op">(</span>M_calibra <span class="op">=</span> <span class="va">M_calibra</span>,</span>
<span>                               G_transfer <span class="op">=</span>  <span class="va">G_transfer</span>,</span>
<span>                               percent <span class="op">=</span> <span class="fl">10</span>,comp_each <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                               normalized <span class="op">=</span> <span class="cn">TRUE</span>, standardize_vars<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"future::sequential"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mop_test_parallel</span><span class="op">)</span></span></code></pre></div>
<p>In fact, the better management of memory and the optimization of the
code allows users to run MOP analyses on huge extents such as the whole
world. Here, we show how to run the MOP using the bioclimatic variables
for the current time at 10 arc minutes and an climate change
scenario.</p>
<p>First, we downloaded the climatic layer for whole world and the
current time at 10 arc minutes. Then, we downloaded the climate change
layers. Finally, we run the MOP analysis in a parallel fashion using 20
cores.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio10_pre</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/worldclim.html" class="external-link">worldclim_global</a></span><span class="op">(</span><span class="st">"bioc"</span>,res<span class="op">=</span><span class="fl">10</span>,path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bio10_fut</span> <span class="op">&lt;-</span> <span class="fu">geodata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geodata/man/cmip6.html" class="external-link">cmip6_world</a></span><span class="op">(</span><span class="st">"CNRM-CM6-1"</span>, <span class="st">"585"</span>, <span class="st">"2061-2080"</span>,</span>
<span>                              var<span class="op">=</span><span class="st">"bioc"</span>, res<span class="op">=</span><span class="fl">10</span>, path<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mop_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"future::multisession"</span>,workers <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="va">mop_basic_res1</span> <span class="op">&lt;-</span> <span class="fu">smop</span><span class="fu">::</span><span class="fu"><a href="../reference/mop.html">mop</a></span><span class="op">(</span>M_calibra <span class="op">=</span> <span class="va">bio10_pre</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">12</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                              G_transfer <span class="op">=</span> <span class="va">bio10_fut</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">12</span>,<span class="fl">15</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                              comp_each <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                              percent <span class="op">=</span> <span class="fl">50</span>,standardize_vars <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                              normalized <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"future::sequential"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mop_time</span></span>
<span><span class="co">#&gt;     user   system  elapsed </span></span>
<span><span class="co">#&gt;  420.586   15.776 2781.064 </span></span></code></pre></div>
<p>This process took about 46 minutes which seems to be a lot of time
but note that this analysis was done for the whole world! Moreover, this
kind of MOP analysis wont run on other packages.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Luis Osorio-Olvera, Rusby G. Contreras-Díaz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
