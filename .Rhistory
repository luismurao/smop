library(microbenchmark)
# data
## current conditions
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
install.packages("microbenchmark")
library(mop)
library(microbenchmark)
# data
## current conditions
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
layers_of_interestb <- raster::stack(layers_of_interest)
s_time <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = reference_layers,
g = layers_of_interest,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = reference_layers,
G_transfer = layers_of_interest,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = reference_layersb,
G_stack = layers_of_interestb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 50
)
terra::plot(mop_basic_res1)
terra::plot(mop_basic_res$mop_distances)
s_time
195.70623/19.12458
library(smop)
terra::plot(mop_basic_res1)
# data
## current conditions
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
layers_of_interestb <- raster::stack(layers_of_interest)
s_time <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = reference_layers,
g = layers_of_interest,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = reference_layers,
G_transfer = layers_of_interest,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = reference_layersb,
G_stack = layers_of_interestb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 50
)
terra::plot(mop_basic_res1)
terra::plot(mop_basic_res$mop_distances)
m_path <- system.file("extdata/M_layers", package = "smop") |>
list.files(full.names=TRUE)
g_path <- system.file("extdata/G_layers", package = "smop") |>
list.files(full.names=TRUE)
M_stack <- terra::rast(m_path)
G_stack <- terra::rast(g_path)
M_stackb <- raster::stack(M_stack)
G_stackb <- raster::stack(G_stack)
s_time2 <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = M_stack, g = G_stack,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
parallel = FALSE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = M_stack,
G_transfer = G_stack,
comp_each = NULL,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = M_stackb,
G_stack = G_stackb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 20
)
s_time2
1721.372/394.338
terra::plot(c(mop_basic_res$mop_basic,mop_basic_res1))
bio10 <- geodata::cmip6_world("CNRM-CM6-1", "585", "2061-2080", var="bioc", res=10, path=tempdir())
bio10_pre <- geodata::worldclim_global("bioc",res=10,path = tempdir())
t6 <- system.time({
future::plan("future::multisession",workers = 20)
mop_basic_res1 <- smop::mop(M_stack = bio10_pre[[c(1,5,6,12,15)]],
G_stack = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
future::plan("future::sequential")
source("~/Dropbox/mop_new/mop_test.R")
bio10 <- geodata::cmip6_world("CNRM-CM6-1", "585", "2061-2080", var="bioc", res=10, path=tempdir())
bio10_pre <- geodata::worldclim_global("bioc",res=10,path = tempdir())
t6 <- system.time({
future::plan("future::multisession",workers = 20)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
t6
install.packages("hexSticker")
remotes::install_github("ropensci/UCSCXenaTools")
library(smop)
pkgdown::build_site()
library(UCSCXenaTools)
library(smop)
install.packages("covr")
Rcpp::sourceCpp("~/Dropbox/mop_new/test_means.cpp")
tiempos
258.38102/38.84999
bio10 <- geodata::cmip6_world("CNRM-CM6-1", "585", "2061-2080",
var="bioc", res=10, path=tempdir())
bio10_pre <- geodata::worldclim_global("bioc",res=10,path = tempdir())
t6 <- system.time({
future::plan("future::multisession",workers = 20)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
t5
t6
2787.464 / 60
library(smop)
rm(list = ls())
library(mop)
library(microbenchmark)
# data
## current conditions
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
layers_of_interestb <- raster::stack(layers_of_interest)
s_time <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = reference_layers,
g = layers_of_interest,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = reference_layers,
G_transfer = layers_of_interest,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = reference_layersb,
G_stack = layers_of_interestb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 50
)
s_time
368.59699/14.50254
bio10 <- geodata::cmip6_world("CNRM-CM6-1", "585", "2061-2080",
var="bioc", res=10, path=tempdir())
bio10_pre <- geodata::worldclim_global("bioc",res=10,path = tempdir())
t6 <- system.time({
future::plan("future::multisession",workers = 20)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
t6
2701.673/60
library(smop)
future::plan("future::multisession",workers = 20)
future::plan("future::sequential")
future::plan("future::sequential")
future::plan("future::sequential")
t6 <- system.time({
future::plan("future::multisession",workers = 20)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
bio10 <- geodata::cmip6_world("CNRM-CM6-1", "585", "2061-2080",
var="bioc", res=10, path=tempdir())
bio10_pre <- geodata::worldclim_global("bioc",res=10,path = tempdir())
t6 <- system.time({
future::plan("future::multisession",workers = 20)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
t6
2710.128/60
rm(list = ls())
devtools::install_github("luismurao/smop")
library(mop)
library(microbenchmark)
# data
## current conditions
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
layers_of_interestb <- raster::stack(layers_of_interest)
s_time <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = reference_layers,
g = layers_of_interest,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = reference_layers,
G_transfer = layers_of_interest,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = reference_layersb,
G_stack = layers_of_interestb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 50
)
library(smop)
rm(list = ls())
devtools::install_github("luismurao/smop")
#devtools::install_github("luismurao/smop")
library(mop)
library(microbenchmark)
# data
## current conditions
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
layers_of_interestb <- raster::stack(layers_of_interest)
s_time <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = reference_layers,
g = layers_of_interest,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = reference_layers,
G_transfer = layers_of_interest,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = reference_layersb,
G_stack = layers_of_interestb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 100
)
s_time
384.09936/16.66764
terra::plot(mop_basic_res1)
terra::plot(mop_basic_res$mop_distances)
m_path <- system.file("extdata/M_layers", package = "smop") |>
list.files(full.names=TRUE)
g_path <- system.file("extdata/G_layers", package = "smop") |>
list.files(full.names=TRUE)
M_stack <- terra::rast(m_path)
G_stack <- terra::rast(g_path)
M_stackb <- raster::stack(M_stack)
G_stackb <- raster::stack(G_stack)
s_time2 <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = M_stack, g = G_stack,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
parallel = FALSE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = M_stack,
G_transfer = G_stack,
comp_each = NULL,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = M_stackb,
G_stack = G_stackb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 20
)
M_stackb <- raster::stack(M_stack)
G_stackb <- raster::stack(G_stack)
s_time2 <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = M_stack, g = G_stack,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
parallel = FALSE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = M_stack,
G_transfer = G_stack,
comp_each = NULL,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = M_stackb,
G_stack = G_stackb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 20
)
s_time2
1774.4374/128.0508
terra::plot(c(mop_basic_res$mop_basic,mop_basic_res1))
bio10 <- geodata::cmip6_world("CNRM-CM6-1", "585", "2061-2080",
var="bioc", res=10, path=tempdir())
bio10_pre <- geodata::worldclim_global("bioc",res=10,path = tempdir())
t6 <- system.time({
future::plan("future::multisession",workers = 10)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
t6
1668.515/60
t6 <- system.time({
future::plan("future::multisession",workers = 22)
mop_basic_res1 <- smop::mop(M_calibra = bio10_pre[[c(1,5,6,12,15)]],
G_transfer = bio10[[c(1,5,6,12,15)]],
comp_each = 10000,
percent = 50,standardize_vars = TRUE,
normalized = TRUE)
future::plan("future::sequential")
})
t6
1746.873/60
library(smop)
rm(list = ls())
library(mop)
library(microbenchmark)
library(parallelDist)
library(RcppXPtrUtils)
# data
## current conditions
arma_code <- '
double calcMOP(const arma::mat &A, const arma::mat &B){
return arma::accu(arma::square(A - B));
}
'
#compileuser-defined function and return pointer
#(RcppArmadillo is used as dependency)
euclideanFuncPtr<-cppXPtr(arma_code,depends=c("RcppArmadillo"))
reference_layers <- terra::rast(system.file("extdata", "reference_layers.tif",
package = "mop"))
## future conditions
layers_of_interest <- terra::rast(system.file("extdata",
"layers_of_interest.tif",
package = "mop"))
reference_layersb <- raster::stack(reference_layers)
layers_of_interestb <- raster::stack(layers_of_interest)
reference_layers_m <- na.omit(reference_layersb[])
layers_of_interest_m <- na.omit(layers_of_interest[])
parD_mop <- parDist(list(reference_layers_m,layers_of_interest_m),
method="custom",func=euclideanFuncPtr)
s_time <- microbenchmark::microbenchmark(mop_basic_res <- mop::mop(m = reference_layers,
g = layers_of_interest,
type = "basic",
calculate_distance = TRUE,
percentage = 50,
where_distance = "all",
distance = "euclidean",
rescale_distance =  TRUE,
scale = TRUE,
center = TRUE),
mop_basic_res1 <- smop::mop(M_calibra = reference_layers,
G_transfer = layers_of_interest,
percent = 50,
standardize_vars = TRUE,
normalized = TRUE),
mop_ntbox <- ntbox::mop(M_stack = reference_layersb,
G_stack = layers_of_interestb,
percent = 50,
normalized = TRUE,
parallel = FALSE),
times = 100
)
s_time$time
s_time$expr
s_time
387.26510/ 15.57305
terra::rast
terra::rast()
terra::values
package = "smop"),
m_stack <- terra::rast(list.files(system.file("extdata",
package = "smop"),
pattern = "M_layers.tif$",
full.names = TRUE))
full.names = TRUE))
m_stack <- terra::rast(list.files(system.file("extdata",
package = "smop"),
pattern = "M_layers",
full.names = TRUE))
g_stack <- raster::stack(list.files(system.file("extdata",
pattern = ".tif$",
m_stack <- terra::rast(list.files(system.file("extdata/M_layers",
package = "smop"),
pattern = ".tif$",
full.names = TRUE))
g_stack <- raster::stack(list.files(system.file("extdata",
system.file("extdata/M_layers",
package = "smop")
list.files(system.file("extdata/M_layers",
package = "smop"),
pattern = ".tif$",
full.names = TRUE)
#' @examples
m_stack <- terra::rast(list.files(system.file("extdata/M_layers",
package = "smop"),
pattern = ".tif$",
full.names = TRUE))
g_stack <- raster::stack(list.files(system.file("extdata/G_layers",
package = "smop"),
pattern = ".tif$",
full.names = TRUE))
m_calibra <- terra::rast(list.files(system.file("extdata/M_layers",
package = "smop"),
pattern = ".tif$",
full.names = TRUE))
g_transfer <- raster::stack(list.files(system.file("extdata/G_layers",
package = "smop"),
pattern = ".tif$",
full.names = TRUE))
NT1 <- exdet_univar(M_stack = m_stack,
G_stack = g_stack,G_mold=NULL)
rm(list=ls())
quit()
